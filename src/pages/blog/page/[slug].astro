---
import Pagination from "@/components/Pagination.astro";
import config from "@/config/config.json";
import Base from "@/layouts/Base.astro";
import { client } from "@/lib/sanityClient"; 
import { LIST_QUERY, POSTS_SLUG_QUERY } from "@/lib/sanityQueries"; // ðŸš€ PERBAIKAN IMPORT
import { markdownify } from "@/lib/utils/textConverter";
import Post from "@/partials/Post.astro";

const POSTS_PER_PAGE = config.settings.pagination; 

// 1. getStaticPaths: Menghitung berapa banyak halaman pagination yang harus dibuat.
export async function getStaticPaths() {
Â  // Menggunakan POSTS_SLUG_QUERY agar fetch lebih ringan
Â  const allPosts = await client.fetch(POSTS_SLUG_QUERY);
Â Â 
Â  const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
Â  const paths = [];

Â  // Buat paths untuk halaman 2 dan seterusnya (halaman 1 ditangani oleh index.astro)
Â  for (let i = 1; i < totalPages; i++) {
Â  Â  paths.push({
Â  Â  Â  params: {
Â  Â  Â  Â  slug: (i + 1).toString(),
Â  Â  Â  },
Â  Â  });
Â  }
Â  return paths;
}


// 2. Logika Pengambilan Konten & Pagination
const { slug } = Astro.params;

const blogTitle = "Blog"; // Hardcode atau ambil dari config/Sanity settings

// Ambil SEMUA post (dengan data penuh yang dibutuhkan oleh <Post>)
const allPosts = await client.fetch(LIST_QUERY);
const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);

// Lakukan logic pemotongan array (pagination)
const currentPage = slug && !isNaN(Number(slug)) ? Number(slug) : 1;
const indexOfLastPost = currentPage * POSTS_PER_PAGE;
const indexOfFirstPost = indexOfLastPost - POSTS_PER_PAGE;
const currentPosts = allPosts.slice(indexOfFirstPost, indexOfLastPost);

---

<Base title={blogTitle}>
Â  <section class="section">
Â  Â  <div class="container">
Â  Â  Â  <h1
Â  Â  Â  Â  class="mb-10 text-center font-normal lg:text-[56px]"
Â  Â  Â  Â  set:html={markdownify(blogTitle)}
Â  Â  Â  />
Â  Â  Â  <div class="row">
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  currentPosts.map((post) => (
Â  Â  Â  Â  Â  Â  <div class="col-12 mb-8 sm:col-6">
Â  Â  Â  Â  Â  Â  Â  <Post post={post} />Â 
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  ))
Â  Â  Â  Â  }
Â  Â  Â  </div>
Â  Â  Â  <Pagination
Â  Â  Â  Â  section={"blog"}
Â  Â  Â  Â  totalPages={totalPages}
Â  Â  Â  Â  currentPage={currentPage}
Â  Â  Â  />
Â  Â  </div>
Â  </section>
</Base>